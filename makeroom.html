<!DOCTYPE html>
<!-- COPYRIGHT Â© 2019 BENJAMIN CICCARELLI -->
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ben Ciccarelli</title>
    <meta property="og:title" content="Ben Ciccarelli">
    <meta property="og:locale" content="en_US">
    <link rel="shortcut icon" type="image/png" href="images/b.png"/>
    <link rel="canonical" href="http://ciccarelli.me/">
    <meta property="og:url" content="http://ciccarelli.me/">
    <meta property="og:site_name" content="Ben Ciccarelli">
    <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>
    <div id="titleSlide">
      <div id="title" style="width: 50%">Make Room<p>"Make Room" is a game inspired by the 1966 book "Make Room! Make Room!" by Harry H. as well as the movie "Soylent Green"</p></div>
      <button id="projectButton" onclick="play()">Play Minigame</button>
      <button id="projectButton" onclick="window.location.href = 'makeroomgame.html';">Full Game</button>
      <button id="back" style="position: fixed; top: 10px; right: 10px;" onclick="window.location.href = 'makeroommap.html';">Go To Map</button>
    </div>
  </body>
  <script type="text/javascript">
    var canvas,ctx;
    var mousePos = {x:0,y:0}
    var objects = []
    var population=100
    var soylentSpeed=0
    var capacity=100
    var budget = 100
    var death = 0
    var started = false
    var inMenu = false
    var menuObjects = []
    function play() {
      ts = document.getElementById("titleSlide")
      ts.innerHTML = "<canvas id='c' width='1080' height='720'></canvas>"
      ts.style = "margin-top:10px"
      canvas = document.getElementById("c")

      canvas.onmousemove = function (evt) {
        var rect = canvas.getBoundingClientRect();
        mousePos = {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }
      canvas.onclick = function (evt) {

        var rect = canvas.getBoundingClientRect();
        console.log({
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        })
        if(!inMenu) {
          for (var i = 0; i < objects.length; i++) {
            if(mouseIn(objects[i]) && objects[i].click) {
              objects[i].click()
              return
            }
          }
        } else {
          if(!mouseIn(menu)) {
            inMenu = false
            menu.visible = false
            return
          }
          for (var i = 0; i < menuObjects.length; i++) {
            if(mouseIn(menuObjects[i]) && menuObjects[i].click) {
              menuObjects[i].click()
              return
            }
          }

        }
      }
      ctx = canvas.getContext("2d")            
      ctx.font = "20px Consolas";
      ctx.imageSmoothingEnabled = false
      bg = new sprite("assets/bg.png", 0, 0, canvas.width, canvas.height);
      playButton = new sprite("assets/play.png",canvas.width/2-100,canvas.height/2+100,200,100);
      makeRoom = new sprite("assets/makeRoom.png",canvas.width/2-216,canvas.height/2 - 250,432,288);
      ground = new sprite("assets/ground.png",20,canvas.height-550-20,1040,550);
      menu = new sprite("assets/menu.png",20,100,1040,550);
      menu.visible = false
      objects.push(bg)
      objects.push(playButton)
      objects.push(makeRoom)
      objects[1].hover = dim
      objects[1].hoverStop = norm
      objects[1].click = function() {
        objects.splice(objects.indexOf(this),1)
        objects.splice(objects.indexOf(makeRoom),1)
        canvas.style.cursor = "default";
        objects.push(ground)
        n = 0
        for(var i = 40; i < canvas.width - 80; i += 110) {
          for(var j = canvas.height - 580; j < canvas.height - 80; j += 110) {
            
            objects.push(new sprite("assets/base.png",i,j,100,100));
            objects[objects.length-1].id = n
            objects[objects.length-1].hover = dim
            objects[objects.length-1].hoverStop = norm
            objects[objects.length-1].click = baseInteract
            if(Math.random()>.8){
              console.log(n)
              capacity += 100
              population += 50
              objects.push(new sprite("assets/building1.png",i+10,j-70,80,160))
              objects[objects.length-1].id = n + "lot"
              objects[objects.length-1].level = 1
            }

            n++
          }
        }

        objects.push(menu)
        started = true
      }
      setInterval(draw,1000/30)
    }
    function draw() {
      over = undefined
      ctx.fillStyle = "#fff"
      if (started) {
        population += population/1000 - death + 20/population;

        budget += population/10000;
        death *= .9
        soylentSpeed += soylentSpeed/1000
        capacity -= soylentSpeed/15
      }
      for (var i = 0; i < objects.length; i++) {
        objects[i].draw()
        if(mouseIn(objects[i]) && objects[i].hover && !inMenu) {
          over = i
        } else if(objects[i].hoverStop) {
          objects[i].hoverStop()
        }
      }

      if(started) {
        ctx.fillText("Population:" + Math.round(population) + "/" + Math.round(capacity), 10, 40);
        ctx.fillText("Budget:$" + Math.round(budget) + "k", 10, 60);
      }
      if(population > capacity) {
        started = false
        inMenu = false
        objects = [objects[0], new sprite("assets/final.png",20,20,1040,550), new sprite("assets/done.png",canvas.width/2-100,canvas.height-120,200,100)]
        objects[2].hover = dim
        objects[2].hoverStop = norm
        objects[2].click = function(){
          location.reload();
        }
        
      }

      if(population < 1) {
        population = 0
        started = false
        inMenu = false
        objects = [objects[0], new sprite("assets/finalDead.png",20,20,1040,550), new sprite("assets/done.png",canvas.width/2-100,canvas.height-120,200,100)]
        objects[2].hover = dim
        objects[2].hoverStop = norm
        objects[2].click = function(){
          location.reload();
        }
        
      }
      
      if(inMenu) {
        for (var i = 0; i < menuObjects.length; i++) {
          menuObjects[i].draw()
          if(mouseIn(menuObjects[i]) && menuObjects[i].hover) {
            over = i
          } else if(menuObjects[i].hoverStop) {
            menuObjects[i].hoverStop()
          }
        }
        if(menuObjects[over] && menuObjects[over].hover){
          menuObjects[over].hover()
        }
      } else if(objects[over] && objects[over].hover){
        objects[over].hover()
      }
    }
    function sprite(src, x, y, sx, sy){
      this.x = x
      this.y = y
      this.sx = sx
      this.sy = sy
      this.visible = true
      this.image = new Image()
      this.image.src = src
      this.draw = function(){
        if(this.visible){
          ctx.filter = ""
          ctx.filter = this.visible;
          ctx.drawImage(this.image,this.x,this.y,this.sx,this.sy)
          ctx.filter = "none";
        }
      }
    }
    function mouseIn(s) {
      return ((s.x+s.sx)>mousePos.x && mousePos.x>s.x && (s.y+s.sy)>mousePos.y && mousePos.y>s.y)
    }
    function dim() {
      this.visible = "brightness(50%)";
      canvas.style.cursor = "pointer"; 
    }
    function norm() {
      this.visible = true
      canvas.style.cursor = "default"; 
    }
    function getObjectById(id){
      for (var i = objects.length - 1; i >= 0; i--) {
        if(objects[i].id == id){
          return objects[i]
        }
      }
    }
    function getIndexById(id){
      for (var i = objects.length - 1; i >= 0; i--) {
        if(objects[i].id == id){
          return i
        }
      }
    }
    function baseInteract() {
      objects[objects.length-1].visible = true
      inMenu = true
      menuObjects = []
      console.log(this.id)
      x = this.x
      y = this.y
      oid = this.id
      ob = getObjectById(this.id+"lot")
      os = getObjectById(this.id+"soy")
      oh = getObjectById(this.id+"home")
      if (ob) {
        o = Object.assign({}, ob);
        o.x = 100
        o.y = 100
        o.sx *= 3
        o.sy *= 3
        menuObjects.push(o)
        upgradeButton = new sprite("assets/upgrade.png",canvas.width/2,canvas.height/2,400,100);
        upgradeButton.hover = dim
        upgradeButton.hoverStop = norm
        upgradeButton.click = function(){
          if(budget>(ob.level*25) && ob.level < 3) {

            budget -= (ob.level*25)
            ob.level++
            console.log(ob.level)
            ob.image.src = "assets/building"+ob.level+".png"
            capacity += ob.level * 100
          }
        }
        menuObjects.push(upgradeButton)
      } else if (os || oh) {
        o = Object.assign({}, os || oh);
        o.x = 100
        o.y = 100
        o.sx *= 3
        o.sy *= 3
        menuObjects.push(o)
      } else {
        bButton = new sprite("assets/building.png",canvas.width/2,canvas.height/2-110,400,100);
        bButton.hover = dim
        bButton.hoverStop = norm
        bButton.click = function(){
          if(budget>10) {
            n = new sprite("assets/building1.png", x+10, y-70, 80, 160)
            n.id = oid+"lot"
            n.level = 1
            objects.splice(getIndexById(oid)+1,0,n)
            console.log(getObjectById(n.id))
            capacity += 100
          }
          inMenu = false
          menu.visible = false
        }

        sButton = new sprite("assets/soylent.png",canvas.width/2,canvas.height/2,400,100);
        sButton.hover = dim
        sButton.hoverStop = norm
        sButton.click = function(){
          if(budget>10) {
            n = new sprite("assets/soylent1.png", x+10, y, 80, 80)
            n.id = oid+"soy"
            objects.splice(getIndexById(oid)+1,0,n)
            console.log(getObjectById(n.id))
            capacity += 250
            soylentSpeed += 1
          }
          inMenu = false
          menu.visible = false
        }

        hButton = new sprite("assets/home.png",canvas.width/2,canvas.height/2+110,400,100);
        hButton.hover = dim
        hButton.hoverStop = norm
        hButton.click = function(){
          if(budget>10) {
            n = new sprite("assets/home1.png", x+10, y, 80, 80)
            n.id = oid+"home"
            objects.splice(getIndexById(oid)+1,0,n)
            console.log(getObjectById(n.id))
            death += 10
          }
          inMenu = false
          menu.visible = false
        }

        menuObjects.push(bButton)
        menuObjects.push(sButton)
        menuObjects.push(hButton)
      }
    }
  </script>
</html>
